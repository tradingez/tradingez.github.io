"use strict";angular.module("sbAdminApp").controller("RecommendationCtrl",function($scope,$rootScope,$stateParams,TradingApi,$location,APP_SERVICES,Helper){var dateRanges=Helper.getDateRange();dateRanges.unshift("Tất cả"),$scope.filterStockTypes={avalableOptions:[{value:"star",name:"CP Stock Pick"},{value:"top",name:"CP Top 50"},{value:"tc",name:"CP Tiêu Chuẩn"}],selectedOption:{value:"star",name:"CP Stock Pick"}},$scope.filterTimes={avalableOptions:dateRanges.map(function(item){return{value:item,name:item}}),selectedOption:{value:dateRanges[0],name:dateRanges[0]}},TradingApi.tradingBox().then(function(response){if(response&&response){$scope.data=response,$scope.monthData=response.monthData;var overallTickerData=response.overallData.tickerData;$scope.overallTickerData=Object.values(overallTickerData).map(function(item){return JSON.parse(item)}).sort(function(a,b){return b.buyDate-a.buyDate}),$scope.tickerData=$scope.overallTickerData}}),$scope.filterStockTypeHandler=function(){var category=$scope.filterStockTypes.selectedOption.value;category||(category="star",$scope.filterStockTypes.selectedOption={value:"star",name:"CP Stock Pick"}),$scope.filterTimes.selectedOption={value:dateRanges[0],name:dateRanges[0]},TradingApi.tradingBox(category).then(function(response){if(response&&response){$scope.data=response,$scope.monthData=response.monthData;var overallTickerData=response.overallData.tickerData;$scope.overallTickerData=Object.values(overallTickerData).map(function(item){return JSON.parse(item)}).sort(function(a,b){return b.buyDate-a.buyDate}),$scope.tickerData=$scope.overallTickerData}})},$scope.filterTimeHandler=function(){var time=$scope.filterTimes.selectedOption.value;if(time&&time!=dateRanges[0]){var monthData=$scope.monthData.filter(function(item){return item.title==time});if(monthData&&monthData.length){var tickerData=monthData[0].tickerData;$scope.tickerData=Object.values(tickerData).map(function(item){return JSON.parse(item)}).sort(function(a,b){return b.buyDate-a.buyDate})}else $scope.tickerData=[]}else $scope.filterTimes.selectedOption={value:dateRanges[0],name:dateRanges[0]},$scope.tickerData=$scope.overallTickerData}});